- 环境的部署和服务的安装是根据教程手动配置的，没有出错，部署文档中就不再赘述，下面主要是安装dashboard、制作镜像、网络配置和启动实例.

- 我的网络配置如下：

  controller node: ens33 
  
  management network ip addr 192.168.15.133/24

  compute node: ens34
  
  management network ip addr 192.168.15.134/24

- Dashboard -- controller node

  Install the packages:
  ```
  # apt install openstack-dashboard 
  ```

  配置

  ```
  # vi /etc/openstack-dashboard/local_settings.py   
  OPENSTACK_HOST = "192.168.15.133" 
  ALLOWED_HOSTS = ['*'] //允许所有主机访问仪表板 
  SESSION_ENGINE = 'django.contrib.sessions.backends.cache'
  CACHES = { 
    'default': { 
         'BACKEND': 'django.core.cache.backends.memcached.MemcachedCache', 
         'LOCATION': '192.168.15.133:11211', 
    } 
  }
  OPENSTACK_KEYSTONE_URL = "http://%s:5000/v3" % OPENSTACK_HOST
  OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True
  OPENSTACK_API_VERSIONS = { 
    "identity": 3, 
    "image": 2, 
    "volume": 2, 
  } 
  OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = "default"
  OPENSTACK_KEYSTONE_DEFAULT_ROLE = "user"
  TIME_ZONE = "Asia/Chongqing" 
  ```

  重新加载 web 服务器配置
  ```
  service apache2 reload
  ```
  浏览器输入 http://192.168.15.133/horizon 访问仪表盘,使用 admin/demo 用户和 default domain验证

  ![dashboard](https://github.com/CourseCloudDesktop/cloudDesktop/blob/wcl-develop/task2/horizon.PNG)

- 启动实例

  创建network

  创建provider network
  ```
  # . admin-openrc
  $ openstack network create  --share --external \
  --provider-physical-network provider \
  --provider-network-type flat provider
  ```

  在网络上创建一个子网
  ```
  $ openstack subnet create --network provider \
  --allocation-pool start=203.0.113.101,end=203.0.113.250 \
  --dns-nameserver 8.8.4.4 --gateway 203.0.113.1 \
  --subnet-range 203.0.113.0/24 provider
  ```

  创建self-service network
  ```
  $ . demo-openrc
  $ openstack network create selfservice
  ```

  在网络上创建一个子网
  ```
  $ openstack subnet create --network selfservice \
  --dns-nameserver 8.8.4.4 --gateway 172.16.1.1 \
  --subnet-range 172.16.1.0/24 selfservice
  ```

  创建router
  ```
  $ . admin-openrc
  //公有提供网络必须包括 router: external 选项，用来使路由连接到外部网络
  # neutron net-update provider --router:external 
  Updated network: provider
  $ . demo-openrc
  $ openstack router create router 
  ```

  给路由器添加一个私网子网的接口
  ```
  $ neutron router-interface-add router selfservice
  ```

  给路由器设置公有网络的网关
  ```
  $ neutron router-gateway-set router provider
  ```

  验证操作(跟教程中验证结果相同)
  ```
  $ . admin-openrc
  $ ip netns
  $ neutron router-port-list router
  $ ping -c 4 203.0.113.102

  ```
  创建m1.nano规格的主机
  ```
  $ openstack flavor create --id 0 --vcpus 1 --ram 64 --disk 1 m1.nano
  ```
  生成一个键值对
  ```
  $ . demo-openrc
  $ ssh-keygen -q -N ""
  $ openstack keypair create --public-key /home/caroline/.ssh/id_rsa.pub mykey
  //验证公钥的添加
  $ openstack keypair list

  ```
  增加安全组规则
  ```
  //ICMP
  $ openstack security group rule create --proto icmp default
  //SSH
  $ openstack security group rule create --proto tcp --dst-port 22 default

- 下面是启动实例，因为在网络设置中设置的是self-service network，所以这里启动实例时在provider network和self-service network中都可以

  此时可以在dashboard中找到实例类型、镜像、网络，与上面设置的相同，此时用命令行或者是dashboard都可以启动实例
  
  在私有网络上创建实例 
  ```
  $ . demo-openrc
  $ openstack network list
  //根据上面命令列出的selfservice id填充下面的命令
  $ openstack server create --flavor m1.nano --image cirros \
  --nic net-id=SELFSERVICE_NET_ID --security-group default \
  --key-name mykey selfservice-instance
  $ openstack server list
  ```

  创建实例后直接查看状态是BUILD,等创建过程结束后status就会变成ACTIVE。可以在dashboard中查看启动中的实例，之后也可以通过教程中的方法一一验证，部署文档中就不再赘述了。

  ![INSTANCE](https://github.com/CourseCloudDesktop/cloudDesktop/blob/wcl-develop/task2/y.PNG)
  


