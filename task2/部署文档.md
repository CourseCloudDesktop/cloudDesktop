在经历了无数次的挣扎之后终于把任务2的锅补完了，只能说打不死的小强确实挺坚强的哈~ 哈哈哈，下面是任务2的部署文档
## 一、任务：
- 用集成脚本安装openstack，能够成功打开dashboard
- 制作镜像
- 虚拟网络

## 二、具体描述：
1. 成功搭建openstack环境后，通过dashboard登录。
2. 登陆后查看系统信息（看启动了什么服务）
3. 测试网络配置是否正确
    - 上传cirros镜像、创建flavor、创建vxlan网络、ext_net网络、路由
    - 创建实例
    - 添加安全组规则（ssh、icmp）
    - 尝试从不同实例之间互相ping。看是否成功
    具体参考这篇博客的后半部分：
    https://blog.csdn.net/dylloveyou/article/details/77148560 
    
## 三、任务完成情况
| 编号  | 项目内容 | 完成情况  | 未完成原因  | 措施  | 如何解决安装过程中遇到的问题 |
| :--- | :--------| :--------|:------------|:------| :-----------|
| 1    | 安装Ubuntu server虚拟机 |  100%  | / | /| / |
| 2    |   安装部署OpenStack|  100%  | / |/ | 详见"五、问题与解决方法" |
| 3    |   网络配置| 100%  | / | /| /|
| 4    |   制作镜像| 100% |  / | /| /|
| 5    |   虚拟网络| 100% |  / | /| /|

## 四、部署文档
### 1、Ubuntu Server的安装配置
#### 1.1 下载VMworkstation和Ubuntu Server
上官网下载就OK了，注意这里的Vmworkstation需要时V.12及以上的版本。

#### 2.1 安装Vmworkstation和Ubuntu Server
（1）安装Ubuntu Server前对虚拟机的网卡的配置：
设置网卡1的模式为NAT模式：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/vm2.png" width="60%" height="60%" />

设置网卡2的模式为仅主机模式：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/vm3.png" width="60%" height="60%" />

（2）安装Ubuntu Server
一下是安装Ubuntu Server的基本过程（网上也可以找到，但是因为有一些配置会有点不一样，所以这里把安装过程列出来）

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/ubun1.png" width="60%" height="60%" />

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/ubun2.png" width="60%" height="60%" />

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/ubun3.png" width="60%" height="60%" />

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/ubun4.png" width="60%" height="60%" />

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/ubun5.png" width="60%" height="60%" />

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/ubun6.png" width="60%" height="60%" />

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/ubun7.png" width="60%" height="60%" />

这里只选择第一个就OK了，后面的选择了的话我安装的时候会出现错误：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/ubun8.png" width="60%" height="60%" />

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/ubun9.png" width="60%" height="60%" />

这里的内容的更改不会影响本地机器：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/ubun10.png" width="60%" height="60%" />

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/ubun11.png" width="60%" height="60%" />

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/ubun12.png" width="60%" height="60%" />

选是，这里的更改不会影响到本地机器：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/ubun13.png" width="60%" height="60%" />

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/ubun14.png" width="60%" height="60%" />

### 2、用集成脚本安装OpenStack
#### 2.1 安装前的配置
配置网卡：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/conf.png" width="60%" height="60%" />

重启网络，并检验网络的连通性：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/ping.png" width="60%" height="60%" />

#### 2.2 安装
运行安装脚本：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/1.png" width="60%" height="60%" />

#### 2.3 打补丁
按照要求打补丁

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/2.png" width="60%" height="60%" />

这里就只放一个补丁的运行过程了

### 3、在浏览器端完成相关的配置
#### 3.1 验证：打开Dashboard
登录界面如下所示：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/4.png" width="60%" height="60%" />


进入之后的界面首页显示如下所示：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/5.png" width="60%" height="60%" />

#### 3.2 查看服务
查看服务显示如下所示：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/6.png" width="60%" height="60%" />

计算服务显示如下所示：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/7.png" width="60%" height="60%" />

网络代理服务显示如下所示：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/8.png" width="60%" height="60%" />

#### 3.3 上传镜像

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/9.png" width="60%" height="60%" />

### 3.4 添加flavors数
配置信息如下所示：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/10.png" width="60%" height="60%" />

配置结果显示如下所示：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/11.png" width="60%" height="60%" />

### 3.5 为admin用户创建一个VXLAN网络
网络基本配置显示如下所示：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/12.png" width="60%" height="60%" />

创建结果显示如下所示：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/13.png" width="60%" height="60%" />

为刚刚创建的网络配置子网信息：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/14.png" width="60%" height="60%" />

注：这里的网关ip不是随意乱填的，是在服务端查看了IP之后，填上对应的ip地址。

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/15.png" width="60%" height="60%" />

注：配置时分配给子网的网段不是胡乱填写的，是查看虚拟机的配置之后，选择虚拟机网段内的ip地址分配给子网的。

子网的配置结果显示如下所示：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/16.png" width="60%" height="60%" />

### 3.6 为demo用户创建一个VXLAN网络

网络基本配置信息如下所示：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/17.png" width="60%" height="60%" />

为刚创建的网络配置子网信息：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/18.png" width="60%" height="60%" />

这里的子网网段ip同样不是胡乱选择的。

创建结果显示如下所示：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/19.png" width="60%" height="60%" />

### 3.7 配置路由信息
路由的基本配置信息显示如下所示：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/20.png" width="60%" height="60%" />

配置结果显示如下所示：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/21.png" width="60%" height="60%" />

### 3.8 配置网络信息
查看网络拓扑如下所示：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/22.png" width="60%" height="60%" />

为路由器添加网络接口：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/23.png" width="60%" height="60%" />

最终用户通过刚刚路由器添加的接口连接到了云上，显示结果如下所示：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/24.png" width="60%" height="60%" />

### 3.9 创建实例
实例的基本配置信息如下所示：
实例的名字和可用区域配置：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/25.png" width="60%" height="60%" />

实例源选用在之前的步骤中上传的镜像cirros:

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/26.png" width="60%" height="60%" />

flavor选择之前创建的m：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/27.png" width="60%" height="60%" />

最后网络选择配置的内网：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/28.png" width="60%" height="60%" />

创建实例1的结果显示如下所示：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/29.png" width="60%" height="60%" />

实例2配置方法与实例1类似，不再赘述，最终的配置结果如下所示：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/30.png" width="60%" height="60%" />

### 3.10 添加安全组等
创建安全组：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/31.png" width="60%" height="60%" />

添加组规则：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/32.png" width="60%" height="60%" />

添加管理组安全规则：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/33.png" width="60%" height="60%" />


最终配置结果显示如下所示：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/34.png" width="60%" height="60%" />

配置成功后查看网络拓扑：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/35.png" width="60%" height="60%" />

发现两个实例都成功的连接到了云上。

### 3.11 不同实例之间的互ping
查看实例：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/36.png" width="60%" height="60%" />

实例2 ping 实例1：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/37.png" width="60%" height="60%" />

实例1 ping 实例2：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/38.png" width="60%" height="60%" />

发现可以成功ping通，至此任务2就算圆满的完成了。


## 五、问题及解决办法
问题1：OpenStack安装到37%失败

措施1：主要是硬盘和内存分配不够，分配至少4G内存和60G硬盘

问题2： OpenStack安装到55%失败

措施2：重新设置了虚拟机的网络配置，并且eth0为静态ip，eth1为动态获取。虚拟机的两个网络适配器一个为NAT模式，另一个为仅主机模式，二者所处的网段不同 

问题3：打不开dashboard

措施3：在/var/log/apache2/error.log下查看发现如下错误：

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/err5.png" width="80%" height="80%" /> 

解决办法：更改 /etc/openstack-dashboard/local_settings.py文件，将版本从v3.0变为v2.0 

<img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task2/confimage/solv2.png" width="80%" height="80%" />

## 六、总结
任务2实在是花费了很多的时间，从安装openstack到最终的配置，其中最难的还是安装OpenStack部分的内容，安装的过程从最开始的尝试手动配置环境安装失败，到使用各种不同版本的Ubuntu安装TA给的集成安装部署文档，从一开始的分给虚拟机的内存和硬盘不够导致无法带动OpenStack，到最终各种尝试失败之后选择使用Ubuntu server 14来安装OpenStack，这一个过程确实真的挺漫长的，主要还是个人能力不够吧，以后还要多努力一些才行啊。
在最开始的时候安装失败，不知道愿意就傻乎乎的重装一遍，结果还是不成功，后来安装不成功的时候首先查看作物日志，根据错误日志上网寻找对应的解决办法，最终安装成功了，虽然从开始安装到最终安装成功花了很多时间，但是这个过程中也是学到不少东西。
