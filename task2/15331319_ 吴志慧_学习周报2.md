# OpenStack学习周报2
15331319 吴志慧
## 1. 本周具体工作计划
- 用集成脚本部署OpenStack，能够成功打开dashboard
- 制作镜像
- 虚拟网络
## 2. 已完成的工作
- 成功登录dashboard
- 登录后成功查看系统信息
- 虚拟网络学习
## 3. 未完成的工作
 - 网络配置
 - 镜像制作
## 4. 问题与困难
电脑配置不足，开虚拟机只能开两个，不能完成ping的实验。对OpenStack网络部分的了解还不够，实操能力欠缺。没有找到比较好的实操教程。
# Openstack Networking(Neutron模块)
**OpenStack 的网络服务，现已由之前的 Quantum 改名为 Neutron。
Neutron 提供云计算环境下的虚拟网络功能，目的是为 OpenStack 云更灵活地划分物理网络，在多租户环境下提供给每个租户独立的网络环境。
用户可以创建自己的网络，控制网络流量，也可以控制服务器和设备连接一到时多个网络。**

## **根据创建网络的用户的权限，Neutron network 可以分为：**

   - Provider network：管理员创建的和物理网络有直接映射关系的虚拟网络。

   - Tenant network：租户普通用户创建的网络，物理网络对创建者透明，其配置由 Neutorn 根据管理员在系统中的配置决定。

## **根据网络的类型，Neutron network 可以分为：**

   - VLAN network（虚拟局域网） ：基于物理 VLAN 网络实现的虚拟网络。共享同一个物理网络的多个 VLAN 网络是相互隔离的，甚至可以使用重叠的 IP 地址空间。每个支持 VLAN network 的物理网络可以被视为一个分离的 VLAN trunk，它使用一组独占的 VLAN ID。有效的 VLAN ID 范围是 1 到 4094。

   - Flat network：基于不使用 VLAN 的物理网络实现的虚拟网络。每个物理网络最多只能实现一个虚拟网络。

   - local network（本地网络）：一个只允许在本服务器内通信的虚拟网络，不知道跨服务器的通信。主要用于单节点上测试。

   - GRE network （通用路由封装网络）：一个使用 GRE 封装网络包的虚拟网络。GRE 封装的数据包基于 IP 路由表来进行路由，因此 GRE network 不和具体的物理网络绑定。

   - VXLAN network（虚拟可扩展网络）：基于 VXLAN 实现的虚拟网络。同 GRE network 一样， VXLAN network 中 IP 包的路由也基于 IP 路由表，也不和具体的物理网络绑定。


## **neutron包含组件：**

   - neutron-server
Neutron-server可以理解为一个专门用来接收Neutron REST API调用的服务器，然后负责将不同的rest api分发到不同的neutron-plugin上。

   - neutron-plugin
Neutron-plugin可以理解为不同网络功能实现的入口，各个厂商可以开发自己的plugin。Neutron-plugin接收neutron-server分发过来的REST API，向neutron database完成一些信息的注册，然后将具体要执行的业务操作和参数通知给自身对应的neutron agent。

   - neutron-agent
Neutron-agent可以直观地理解为neutron-plugin在设备上的代理，接收相应的neutron-plugin通知的业务操作和参数，并转换为具体的设备级操作，以指导设备的动作。当设备本地发生问题时，neutron-agent会将情况通知给neutron-plugin。

- 其他部分
	- Neutron database，顾名思义就是Neutron的数据库，一些业务相关的参数都存在这里。

	- Network provider，即为实际执行功能的网络设备，一般为虚拟交换机（OVS或者Linux Bridge）。

 
# 虚拟网络相关概念 
**虚拟网络（内部网络，私有网络）：虚拟机的虚拟机网卡所在的私有网络**

- fixed ip：虚拟机网卡在虚拟网络上的IP
- floating ip: 虚拟网络对应的外部网络上的IP
-  port: 一个网络接口对应一个Port
- interface: 一个网络接口
- public network：指openstack部署环境以外的网络。这个网络可以是datacenter中的另一个网络、internet、或者一个不被openstack控制的私有网络。

## 与public network通信
1. 我们需要在openstack中创建一个network并设置为public。这个network用于虚拟机与public network通信。虚拟机不能直接连接到这个新创建的属性为public的network，所有网络流量必须使用openstack创建的router 从private network路由到public network。在openstack中创建public network，我们只需要使用neutron net-create 命令，并将router:external设置为True。

2. 下一步，我们尝试允许外部客户访问Openstack环境中的虚拟机，通过floating IP可以完成这个功能。 Floating IP由外部网络提供，用户可以将它设置给虚拟机，从而允许外部客户接入虚拟机。

# 浮动IP概念
1. 缺省情况下实例会被赋予固定ip，这时并不能保证实例会马上可以从外面访问到，一般来说需要配置防火墙来允许公共ip，然后建立一条NAT规则从公共ip到私有ip的映射。
2. OpenStack引入了一个叫浮动ip的概念，浮动ip是一些可以从外部访问的ip列表，通常从isp哪里买来的。
3. 浮动ip缺省不会自动赋给实例，用户需要手动从地址池里抓取然后赋给实例。一旦用户抓去后，他就变成这个ip的所有者，可以随意赋给自己拥有的其他实例。如果实例死掉了的话，用户也不会失去这个浮动ip，可以随时赋给其他实例。暂时不支持为了负载均衡多实例共享一个浮动ip。
4. 对于固定ip来说，实例启动后获得的ip也是自动的，不能指定某一个。所以当一个VM歇菜了，再启动也许固定ip就换了一个。
5. 系统管理员可以配置多个浮动ip池，这个ip池不能指定租户，每个用户都可以去抓取。多浮动ip池是为了考虑不同的isp服务提供商，免得某一个isp出故障带来麻烦。
6. 如果运行的是企业云，浮动ip池就是那些openstack外的数据中心都能访问到的ip。
7. 浮动ip机制给云用户提供了很多灵活性，也给系统管理员减少了安全风险，尽量只让OpenStack软件去改防火墙会安全些。
 
 # 创建实例过程
 - 创建OpenStack虚拟机实例前有很多先决条件，如Horizon本身能正常运行并对外提供创建服务；建立在OpenStack三个核心组件之上等。这三个核心组件分别是Keystone、Glance、Nova。
 - Keystone负责授权认证、租户管理、项目权限和配额以及服务目录管理。
 - Glance负责为Nova提供创建实例所需要的镜像文件，这种镜像文件可以包含很多格式，大多数都是我们常见的镜像格式，如raw、qcow2。Nova负责虚拟机生命周期的管理，以及宿主机资源调度。
 - Nova还决定了虚拟机实例建立在哪一台Hypervisor物理机之上。由这三个核心组件协作，Horizon将用户的HTTP请求转换为RESTful请求，然后将RESTful请求分发给Nova API，进行实例创建
 
 
 
