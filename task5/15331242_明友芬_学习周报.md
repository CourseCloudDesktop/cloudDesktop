## 任务
### 云桌面系统功能体验
- 创建固定桌面
- 创建一个课程，并创建一个对应的课程桌面，课程名称请命名为自己的分支

安装文档请见[部署文档](https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task5/%E6%93%8D%E4%BD%9C%E6%96%87%E6%A1%A3.md) 

### 了解云桌面相关背景知识
#### VDI概念解释以及实现原理
虚拟桌面基础架构，指在数据中心的服务器上运行用户桌面的过程。它是一种桌面虚拟化形式，因为它能够为每个用户提供完全个性化的桌面，并具有集中管理的安全性和简单性。VDI使客户能够通过整合和集中桌面来简化管理和成本，同时实现终端用户的移动和在任何设备上随时随地访问虚拟桌面的自由。VDI只是桌面虚拟化的一种实现形式
架构图如下所示：

<div align=center> <img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task5/images/5.png" width="60%" height="60%" /></div>

VDI的优点：
过自身的网络，可以迅速部署一个通用的、 支持的桌面环境。 创建一个 Windows 7 桌面映像并使用该映像来部署您服务器虚拟机监控程序上的虚拟机 (Vm)。 一台服务器可以支持许多虚拟桌面。 这些桌面的每个反应作为一个独立 Windows 7 桌面。 
与不同的是使用远程桌面服务 (RDS)，连接到某个虚拟桌面的用户可以不会影响其他虚拟桌面或主机服务器有该 VM 的所有功能的完全访问权限。 用户仍可以使用远程桌面客户端连接到他们的虚拟桌面。可以将集中部署的更新和更改到 Windows 7。 只需更新的 Windows 7 桌面映像和更新的图像到您的所有用户的重新部署。 他们在下次登录的时，他们就会有更新后的图像与他们保持的所有设置。如果有需要可以回滚到以前的稳定版本的桌面映像的更新有问题，可以快速将这样做。 在执行更新之前保存的上一个图像的副本。 这将帮助用户通过重新部署的前一个图像回滚。 然后让您的用户注销并重新登录接收的前一个图像。 便携式计算机、 台式计算机和客户端连接到一个数据中心中运行 Windows 7 的虚拟机。

VDI的障碍：
VDI 不可能降低桌面成本，因为任何储蓄通常会被重定向到服务器、 网络和存储基础架构。 你得在桌面管理和用户管理，以有效地支持大量的虚拟桌面中作出一些改善。 应用组策略通过 Active Directory 来重定向用户文件夹和实施漫游配置文件会增加您的 VDI 设计的灵活性。
连接到某个虚拟桌面的用户需要恒定的连接到网络。 是否这是通过 LAN 或跨广域网 (WAN) 或远程连接，用户必须连接到虚拟桌面可以高效工作。 用户社区也必须能够在断开连接的环境中运作或 VDI 就不是一个合适的解决方案。 如果没有很多的手机用户，或者如果他们只工作当他们连接到网络时，这可能是一个可行的解决方案。

#### 实现的协议介绍（spice、vnc、rdp），进行对比

- spice: SPICE协议定义了一组协议消息来访问、控制、和接收通过网络从远程计算机设备（如：键盘、视频、鼠标）的操作，并回复发送输出。控制设备既可以在客户端，也可以在服务端。另外，协议定义了一组支持远程服务器从一个网络地址迁移到另一个网络地址。加密传输数据，有一个例外，在选择加密方法上比较灵活。SPICE使用简单的消息传递和不依赖于任何RPC标准或特定的传输层。
SPICE协议的架构如下所示：

<div align=center> <img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task5/images/9.png" width="60%" height="60%" /></div>

客户端与客户机的交互：

<div align=center> <img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task5/images/10.png" width="60%" height="60%" /></div>

Spice agent运行在客户机（虚拟机）操作系统中。Spice server和Spice client利用spice agent来执行一些需要在虚拟机里执行的任务，如配置分辨率，另外还有通过剪贴板来拷贝文件等。从上图可以看出，Spice client与server与Spice Agent的通信需要借助一些其他的软件模块，如在客户机里面，Spice Agent需要通过VDIPort Driver与主机上 QEMU的VDIPort Device进行交互，他们的交互通过一种叫做输入/输出的环进行。Spice Client和Server产生的消息被写入到设备的输出环中，由VDI Port Driver读取；而Spice Agent发出的消息则通过VDI Port Driver先写入到VDI Port Device输入环中,被QEMU读入到Spice server的缓冲区中，然后再根据消息决定由Spice Server直接处理，还是被发往Spice Client中。

- vnc: VNC(Virtual Network Computing)是基于RFB（Remote Frame Buffer）协议进行通信的，是一个基于平台无关的简单显示协议的超级瘦客户系统，由Cambridge的AT&T实验室设计开发的。vnc的缺省端口是main:5900（C/S）和http:5800（B/S）端口。RFB (远程帧缓存) 是一个远程图形用户的简单协议，因为它工作在帧缓存级别上，所以它可以应用于所有的窗口系统，例如：X11,Windows和Mac系统。远程终端用户使用机器（比如显示器、键盘、鼠标）的叫做RFB客户端，提供帧缓存变化的被称为RFB服务器。RFB是基于tcp的一个应用层协议。

<div align=center> <img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task5/images/11.png" width="60%" height="60%" /></div>

协议流程：

<div align=center> <img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task5/images/14.jpg" width="60%" height="60%" /></div>

RFB 是真正意义上的“瘦客机”协议。RFB协议设计的重点在于减少对客户端的硬件需求。这样客户端就可以运行在许多不同的硬件上，客户机的任务实现上就会尽量的简单。RFB协议对于客户端是无状态的。也就是说：如果客户端从服务器端断开，那么如果它重新连接相同的服务器，客户端的状态会被保存。甚至，一个不同的客户端可以用来连接相同的RFB服务器。而在新的客户端已经能够获得与前一个客户端相同的用户状态。因此，用户的应用接口变的非常便捷。只要合适的网络连接存在，那么用户就可以使用自己的应用程序，并且这些应用会一直保存，即使在不同的接入点也不会变化。这样无论在哪，系统都会给用户提供一个熟悉、独特的计算环境。

VNC工作流程总结： 
（1） VNC客户端通过浏览器或VNC Viewer连接至VNC Server。 
（2） VNC Server传送一对话窗口至客户端，要求输入连接密码，以及存取的VNC Server显示装置。 
（3） 在客户端输入联机密码后，VNC Server验证客户端是否具有存取权限。 
（4） 若是客户端通过VNC Server的验证，客户端即要求VNC Server显示桌面环境。 
（5） VNC Server通过X Protocol 要求X Server将画面显示控制权交由VNC Server负责。 
（6） VNC Server将来由 X Server的桌面环境利用VNC通信协议送至客户端，并且允许客户端控制VNC Server的桌面环境及输入装置。


- rdp: 它仅传输服务器所显示的对象的属性变化的控制值，实现快速远程控制，相对于其它采用抓屏图片压缩的远程控制软件，如PCAnyWhere等而言，速度更快，控制更准确。 对于层次划分，主要是指RDP协议网络功能数据传送时通常都包含的各层次，而对于各层次内所实现的单层次连接等功能将做为单独的模块来进行阐述。
一般的RDP协议层次架构：
  
<div align=center> <img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task5/images/12.png" width="60%" height="60%" /></div>

win7上的RDP协议层次架构：

<div align=center> <img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task5/images/12.png" width="60%" height="60%" /></div>

RDP各个网络层次介绍：
  （1） 网络连接层：RDP协议建立在TCP/IP协议之上，由于传输的数据量比较大，因此在协议的底层首先定义一层网络连接层。它定义了一个完事的RDP数据逻辑包，以避免由于网络包长度过长而被分割使数据丢失。
   （2）ISO数据层：在网络连接层之上是ISO数据层，它表示RDP数据的正常连接通信。
   （3）虚拟通道层：在ISO数据层之上，RDP协议定义一个虚拟通道层，用以拆分标示不同虚拟通道的数据，加快客户端处理速度，节省占用网络接口的时间。
   （4）加密解密层：在虚拟通道层之上，RDP定义一个数据加密解密层。此层用于对所有的功能数据进行加密、解密处理。
   （5）功能数据层：在加密解密层之上是功能数据，画面信息，本地资源转换，声音数据，打印数据等所有的功能数据信息都在此层进行处理。另外，根据数据类型的不同，这些数据都有各自不同层次的分割，他们的内部层次结构将在各个功能模块中进行阐述。
   
RDP协议连接过程说明：
  (1) 客户端连接服务器；
  (2) ISO数据层建立连接；
  (3) 发送初始协议相关信息，接收加密、解密密钥；
  (4) 虚拟通道申请；
  (5) 加密形式发送客户端系统信息，同时验证加密协议；
  (6) 平台软件证书验证；
  (7) 各功能建立连接，各功能数据传输，功能实现；
  
- 集成脚本修改了什么配置文件导致控制台可以直接用spice而不是用vnc？（请给出相关的配置文件截图）

---------
