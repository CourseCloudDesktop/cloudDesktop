### 本周具体工作计划
#### 1、云桌面系统功能体验(小组，在操作文档中体现)
- 创建固定桌面
- 创建一个课程，并创建一个对应的课程桌面，课程名称请命名为自己的分支

#### 2、了解云桌面相关背景知识
---

### 本周主要工作内容

#### 1、VDI概念解释以及实现原理（个人理解总结、工作流程，如果通过画图来体现，最好自己画图）

- VDI全称Virtual Desktop Infrastructure，即虚拟桌面基础架构。

  它通过把虚拟服务器放置在数据中心，为每个用户准备好专用的虚拟机并在服务器上部署系统和应用，
然后通过RDP等远程桌面协议将完整的虚拟机桌面交付给用户使用。

- 在硬件层面，VDI包含一个数据中心（虚拟主机系统集群），数据中心内的虚拟主机能够为运行于服务器上虚拟桌面系统提供强大的计算能力。

  所有客户端的计算和内存资源都置于数据中心内，即在数据中心进行集中计算和处理。
  而桌面用户采用客户端或瘦终端方式，仅负责输入输出与界面显示，不参与任何计算和应用。
  由于所有计算都由数据中心负责，对计算资源和存储资源的要求非常高。

- 连接协议是VDI架构的关键因素。

  由于网络是客户端与虚拟服务器之间的唯一连接方式，VDI架构的性能就十分依赖于网络。
  连接协议是否能够为用户提供高性能的虚拟桌面，是否足够高效，都会影响用户的体验。
  
- 实现原理和工作流程

  VDI在服务器前增加了一个VDI Router机制，Router主要将用户请求连接的桌面进行拦截，根据一定的规则找到空闲的虚拟桌面，
  再将客户的数据进行还原，最后把双方连接起来，就完成了VDI的实现。
![](https://github.com/Arururururu/hello-world/blob/master/vdi%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png?raw=true)
  
  VDI的实现协议有spice、vnc、rdp，在下一节介绍。

#### 2、实现的协议介绍（spice、vnc、rdp），进行对比

**1、spice**

- spice是独立计算环境简单协议Simple Protocol for Independent Computing Environment的缩写。它是一个桌面虚拟化数据传输协议，
  具有自适应能力的远程提交协议，能够提供与物理桌面完全相同的最终用户体验。
  借助支持SPICE协议的客户端或者通过浏览器，用户可以访问自己的虚拟桌面。
  
- spice包括协议、客户端、服务端和相应的QXL设备、QXL驱动

 ![](http://static.ilongyuan.cn/ld/ar/upload/images/2017-12-11/5a2e30ad8a247.jpg)
 
 - spice协议
  协议是客户端、服务端和虚拟机三个部分交互时所遵循的准则,借助于spice协议，虚拟桌面各个组件之间才能够顺利交互。
  
  ![](https://pic1.zhimg.com/80/v2-dd82d75f094a49fbad5413a9a04f172f_hd.jpg)
  
 - spice服务器
  spice服务器主要负责向虚拟机的虚拟设备（如键盘鼠标等）传递客户端用户的输入，以及接收并显示虚拟机虚拟显卡对应的画面（QXL）。

 - spice客户端
  spice跨平台（linux&windows）客户端是面向终端用户的接口，负责接收并转换虚拟机数据，以及发送用户输入数据到虚拟机，从而使得用户能够与虚拟机进行交互。

 - QXL设备和驱动
  位于Hypervisor中，部署在虚拟机内的必需组件。


**2、vnc**

- vnc是虚拟网络计算Virtual Network Computing的缩写，是基于RFB（Remote Frame Buffer）协议进行通信的，是一个基于平台无关的简单显示协议的超级瘦客户系统。

- RFB（远程帧缓存）是一个远程图形用户的简单协议，可以应用于所有的窗口系统。
RFB旨在减少对客户端的硬件需求，这样客户端就可以运行在许多不同的硬件上，客户机的任务实现上就会尽量的简单。

- VNC大致由两部分组成：客户端的应用程序(vncviewer)和服务器端的应用程序(vncserver)。

- VNC运行的工作流程如下:

  1、VNC客户端通过浏览器或VNC Viewer连接至VNC Server。
 
  2、VNC Server传送一个对话窗口至客户端，要求输入连接密码，以及存取的VNC Server显示装置。
 
  3、在客户端输入密码后，VNC Server验证客户端是否具有存取权限。
 
  4、若客户端通过VNC Server的验证，则客户端要求VNC Server显示桌面环境。
 
  5、VNC Server通过X Protocol 要求X Server将画面显示控制权交由VNC Server负责。
 
  6、VNC Server将来由 X Server的桌面环境利用VNC通信协议送至客户端，并且允许客户端控制VNC Server的桌面环境及输入装置。

**3、rdp**

- rdp是远程桌面协议Remote Desktop Protocol的缩写，它是一个多通道的协议，通过网络将数据中心的数据传输到最终用户的显示设备上，让客户端（或本地电脑）连上服务器端（或远程桌面端）。<br>
 大部分的Windows都有客户端所需软件，Linux、FreeBSD、Mac OS X也有这些客户端软件，例如Linux、FreeBSD、Mac OS X，因此与远程桌面协议兼容的客户端可在多种操作系统上运行。

**4、三者的对比**

|     | SPICE |  VNC  |  RDP
------------ | ------------- | ------------- | ------------- |
BIOS屏幕显示	|能	|能	|不能
全彩支持	|能	|能	|能
更改分辨率	|能	|能	|能
多显示器	|支持（高达4画面）	|只有一个屏幕	|支持
图像传输	|图像和图形传输	|图像传输	|图像和图形传输
视频播放支持	|GPU加速支持	|不能	|GPU加速支持
音频传输	|双向语音可以控制	|不能	|双向语音可以控制
鼠标控制	|客户端服务器都可以控制	|服务器端控制	|服务器端控制
USB传输	|USB可以通过网络传输	|不能	|USB可以通过网络传输


#### 3、集成脚本修改了什么配置文件导致控制台可以直接用spice而不是用vnc？（请给出相关的配置文件截图）

修改控制节点和计算节点的<code>nova.conf</code>
- 在[DEFAULT] 中添加 
```
vnc_enabled = false 
```
- 添加SPICE的设置
```
[spice] 
enabled=true 
html5proxy_base_url=http://controller:6082/spice_auto.html
#计算节点中改为   html5proxy_base_url=http://compute:6082/spice_auto.html
keymap=en-us 
server_listen=0.0.0.0 
server_proxyclient_address=controller
#计算节点中改为   server_proxyclient_address=compute
agent_enabled=false
```
配置文件截图如下：

<code>nova.conf</code>的目录

![](https://github.com/Arururururu/hello-world/blob/master/%E7%9B%AE%E5%BD%95.png?raw=true)

<code>vnc_enabled = false</code>

![](https://github.com/Arururururu/hello-world/blob/master/vnc.png?raw=true)

spice相关设置

![](https://github.com/Arururururu/hello-world/blob/master/spice-nova-conf.png?raw=true)

---

### 已经完成工作

  创建了一个固定桌面，创建了一个名称为mlp-develop的课程以及该课程的课程桌面
  
---

### 未完成工作

 无
 
---

### 问题与困难


 1、创建固定桌面和课程桌面后，虽然能正常打开桌面的控制台，但是在桌面列表中的状态显示的是异常
 
 原因：询问了ta，ta说可能是因为没有激活系统，建议查找相关日志
 
 
 2、刚开始选择使用者为admin创建了一个固定桌面，由于桌面配置的参数选小了导致创建失败，但是无法删除。
 
 原因：在用户管理中发现管理者admin未激活，若使用者为teacher或student的（两个用户都已激活）就可以删除
 
---

### 下周工作计划

  暂无
  
---

### 建议与意见（如有）

 无

