# 学习周报

* [本周具体工作计划](#本周具体工作计划)
* [本周主要工作内容](#本周主要工作内容)
* [下周工作计划](#下周工作计划)
* [建议与意见](#建议与意见)

----------
<h3 id="本周具体工作计划"> 一、 本周具体工作计划</h3>

1.云桌面系统功能体验(小组，在操作文档中体现)

- 创建固定桌面
- 创建一个课程，并创建一个对应的课程桌面，课程名称请命名为自己的分支

2.了解云桌面相关背景知识(个人，在学习周报中体现，作为本次评分重点，请认真自学，不要复制黏贴)

- VDI概念解释以及实现原理（个人理解总结、工作流程，如果通过画图来体现，最好自己画图）
- 实现的协议介绍（spice、vnc、rdp），进行对比
- 集成脚本修改了什么配置文件导致控制台可以直接用spice而不是用vnc？（请给出相关的配置文件截图）
  
<h2 id="本周主要工作内容">二、本周主要工作内容</h2>

###  1. 已经完成工作

####  1）云桌面系统功能体验

####  2）了解云桌面相关背景知识

#### （1）VDI概念解释以及实现原理

**VDI**（Virtual Desktop Infrastructure）：虚拟桌面基础架构，为每一个用户提供一对一的、独立的、个性化的定制桌面。

VDI的虚拟桌面解决方案的原理是通过在服务器安装服务器虚拟化软件即为每个用户准备其专用的虚拟机，并在其中部署桌面虚拟化软件以及用户所需的操作系统和各种应用软件，然后通过桌面远程显示协议将完整的虚拟机桌面交付给远程的用户。

目前的虚拟桌面基础架构都以下图结构为原型：

<img src="https://img-blog.csdn.net/20180607145312977?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JlYXNoYXBlcl8=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" width=70%>

- 用户访问层：用户访问层是用户进入VDI的入口。用户通过支持VDI访问协议的各种设备，如电脑、瘦客户端、上网本和手持移动设备等来访问。
- 虚拟架构服务层：
	- Hypervisor：Hypervisor为虚拟桌面的虚拟机提供虚拟化运行环境。
	- 用户虚拟桌面（Hosted virtual desktop，HVD）：虚拟机里面运行的桌面操作系统和应用就是一个用户虚拟桌面。
	- 连接管理器（Connection broker）：用户的访问设备通过连接管理器来请求虚拟桌面。它管理访问授权，确保只有合法的用户能够访问VDI。一旦用户被授权，连接管理器就将把用户请求定向到分配的虚拟桌面；如果虚拟桌面不可用，那么连接管理器将从管理和提供服务（Management and provisioning service）中申请一个可用的虚拟桌面。
	- 管理和提供服务（Management and provisioning service）：管理和提供服务集中化管理虚拟架构，它提供单一的控制界面来管理多项任务。它提供镜像管理、生命周期管理和监控虚拟桌面。
- 存储服务层：存储服务层存储用户的个人数据、属性、母镜像和实际的虚拟桌面镜像。虚拟架构服务层调用存储协议来访问数据。

VDI工作流程总结如下：

（1）用户请求访问桌面 

（2）连接管理器寻找闲置桌面 

（3）存储服务层返回用户数据

（4）将用户数据定向到分配的虚拟桌面 

（5）将用户的请求定向到该桌面

传统的客户-服务器端应用要求在每个用户的计算机上安装客户端软件，从而导致过高的成本，因为需要在分布式网络上管理这些软件的部署、补丁和升级。采用了这样的桌面虚拟化技术之后，就不需要在每个用户的桌面上部署和管理多个软件客户端系统，所有应用客户端系统都将一次性地部署在数据中心的一台专用服务器上，这台服务器放在应用服务器之前。只有虚拟的客户端界面（屏幕图像更新、按键、鼠标移动等）被实际传送并显示在用户的计算机上，而终端用户的感觉好像是实际的客户端软件正在他的桌面运行一样。
![这里写图片描述](https://img-blog.csdn.net/20180607153321730?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JlYXNoYXBlcl8=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

#### （2）实现的协议介绍（spice、vnc、rdp），进行对比

**SPICE**

SPICE协议虚拟桌面结构图：

<img src="https://img-blog.csdn.net/20180607143826626?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JlYXNoYXBlcl8=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" width=70%>

- SPICE（Simple Protocol for Independent Computing Environment）独立计算环境简单协议
- 与虚拟机操作系统无关：SPICE工作于KVM虚拟化机制层面，虚拟机屏幕数据的获取在虚拟化层面完成，因此与KVM上面运行的虚拟机操作系统种类无关，可以加载Windows、CentOS、Fedora、Kylin等多种操作系统。
- USB重定向控制简单：对USB的重定向控制并不需要Windows AD域的参与，直接通过对生虚拟机的镜像进行处理后，即可在创建虚拟机时决定虚拟机是否提供USB重定向支持，因此管理较为简单。
- 安全控制易于处理：由于SPICE的虚拟桌面是连接到运行虚拟机的宿主机中的，并不需要直接连接虚拟机本身用于提供业务的IP地址，因此安全控制及流量均衡更易于处理。
- 能自动平衡客户端与后端服务器的CPU等处理资源。即如果前端的CPU/GPU处理能力强，则会直接使用前端的CPU/GPU资源，从而降低后端服务器的运行压力。
- SPICE的不足之处在于对网络带宽消耗比RDP要大很多，因此更适于在局域网环境中使用。

**RDP**

RDP协议虚拟桌面结构图：

<img src="https://img-blog.csdn.net/20180607142558105?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JlYXNoYXBlcl8=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" width=70%>

- RDP（Remote Desktop Protocol）是一个多通道的协议，RDP协议与Windows环境融合得很好，经过了近7个版本的发展，是最容易使用的一个协议。同时，由于它能够较容易地完成本地主机与虚拟机间USB、磁盘、声音设备重定向，因此在一些不对桌面虚拟化进行限制的部分办公应用场景中，它是一个简单易行的方法。
- RDP的另一项最重要的优势在于它能够在低速线路上同时支持更多的桌面连接，较适于基于广域低速线路上的桌面虚拟化应用要求。
- RDP的不足之处主要是以下几点：
	- RDP虚拟机桌面处理的压力均在后端服务器，前端的PC或瘦终端设备的CPU处理能力基本上得不到充分利用。
	- 前段需要直接通过RDP协议连接虚拟机本身的IP地址及3389端口，但不论是公网还是私网环境，虚拟机的业务IP地址是无法隐藏的，因此安全性方面的防护就是一个需要进一步考虑的问题。
	- 在一些虚拟桌面应用场景中，我们希望能限制某些人对虚拟机数据的上传或下载，因此希望能禁用USB或磁盘重定向功能，此时需要在系统中部署Windows AD域控制服务器，通过安全策略控制每个用户对资源的访问能力。此时，对于一些中小环境应用来说，复杂度会提高很多。

**VNC**

- VNC（Virtual Network Computing）它是一个桌面共享系统
- VNC使用了RFB(Remote FrameBuffer，远程帧缓冲）协议来实现远程控制另外一台计算机
- RFB是基于tcp的一个应用层协议。RFB协议对于客户端是无状态的。也就是说：如果客户端从服务器端断开，那么如果它重新连接相同的服务器，客户端的状态会被保存。
- VNC由两部分组成：客户端的应用程序（VNC Viewer）和服务器端的应用程序（VNC Server）
- VNC运行的工作流程如下:
	- VNC Viewer 通过VNC Viewer或浏览器连接VNC Server
	- VNC Server传送一个对话窗口到客户端，要求输入连接密码，以及存取的VNC Server显示装置
	- 在客户端输入密码后，VNC Server验证客户端是否具有存取权限
	- 若客户端通过VNC Server的验证，则客户端要求VNC Server显示桌面环境
	- VNC Server通过X Protocol 要求X Server将画面显示控制权交由VNC Server负责
	- VNC Server将来由 X Server的桌面环境利用VNC通信协议送至客户端，并且允许客户端控制VNC Server的桌面环境及输入装置

**三种协议对比**
|选项|SPICE|VNC|RDP|
|--|--|--|--|--|
|BIOS屏幕显示|能|能|不能|
|全彩支持|能|能|能|
|更改分辨率|能|能|能|
|多显示器|多显示器支持（多达四画面）|只有一个屏幕|多显示器支持|
|图像传输|图像和图形传输|图像传输|图像和图形传输|
|视频播放格式|GPU加速支持|不能|GPU加速支持|
|音频传输|双向语音可以控制|不能|双向语音可以控制|
|鼠标控制|客户端服务器可以控制|服务器端控制|服务器端控制|
|USB控制|USB可以通过网络传输|不能|USB可以通过网络传输|

#### （3）集成脚本修改了什么配置文件导致控制台可以直接用spice而不是用vnc？（请给出相关的配置文件截图）

在`nova.conf`配置文件中：

![这里写图片描述](https://img-blog.csdn.net/20180607215156686?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JlYXNoYXBlcl8=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

`vnc_enable = False`禁用了vnc

![这里写图片描述](https://img-blog.csdn.net/20180607215208206?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JlYXNoYXBlcl8=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

且配置了spice协议内容：

![这里写图片描述](https://img-blog.csdn.net/20180607215348812?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JlYXNoYXBlcl8=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

####  2. 未完成的工作
无。   

#### 3. 问题与困难

创建固定桌面时，桌面列表中的状态显示的是异常，但还是能正常打开桌面的控制台。

<h3 id="下周工作计划"> 三、 下周工作计划</h3>
自由拓展，了解openstack上的开源项目。

<h3 id="建议与意见"> 四、建议与意见</h3>
无。




