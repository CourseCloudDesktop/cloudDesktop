# task3学习周报

## 本周具体工作内容

- 制作ubuntu的镜像，格式为qcow2
- 利用openstack上传镜像
- 能够成功创建、开启实例
## 本周主要工作内容
### 已经完成工作
- 重新利用集成脚本部署了openstack。

  因为上周的部署是手动部署的，采用了两个节点的结构，但是同时开两个虚拟机电脑负荷过大，所以选择重新再用集成脚本部署AllInOne的openstack。新的节点的系统根据教程上选择了ubuntu14.04.5 server，安装中的确出现了一些问题。有些问题根据同学上次周报中的方法成功解决了，非常感谢。但我在安装过程中还是出现了另外一些问题，导致耗时很久,如下图：

  ![problem](https://github.com/CourseCloudDesktop/cloudDesktop/blob/wcl-develop/task3/screenshot/fault.jpg)
  
  这个问题出现在55%，查看log也没有得到多大提示，尝试了多次重装环境之后，发现它还是跟网卡状态有关的，首先再运行./run.sh之前，用命令ip addr可以查看到网卡的状态，这里eth0和eth1都要是UP才行，如果是down，就用命令’ifconfig 网卡名 up‘重启网卡，两个网卡的状态都是UP时，就不会出现这种问题了。

- task3内容
  
  这里在网上下载了ubuntu16.04的[cloud镜像](http://cloud-images.ubuntu.com/xenial/current/ ),之后启动虚拟机，打开dashboard上传镜像并创建实例。这里的过程与task2的过程几乎一样，首先上传镜像，格式选择为qcow2；之后创建外部网络和子网，创建内部网络和子网，创建路由器关联外部网络和内部网络；配置安全组，创建密钥对；最后创建实例，利用上传的镜像，flavor根据运行镜像所需的大小选择m1.small，网络选择内部网络，添加创建的密钥对和安全组，创建实例后为实例分配浮动ip。完成上面步骤后就可以通过控制台打开实例了。创建实例结果如下图：
  
  ![instance](https://github.com/CourseCloudDesktop/cloudDesktop/blob/wcl-develop/task3/screenshot/实例.PNG)

  在启动虚拟机时也发现了一些问题，打开dashboard检查系统信息时，发现网络代理程序中L3 agent和Open vSwitch agent是关闭的，解决方法就是重启服务，用命令行‘service XXX restart’解决，之后刷新dashboard检查，代理已经开启。 

- 为什么要制作镜像
  
  把安装配置好的系统制作成镜像，使用镜像来创建系统时，用户不需要再多进行配置就能得到已经配置好的最基本的系统了，非常方便。

- iso和qcow2、img格式
  
  iso是光盘的镜像文件，一般都是将光盘文件做成一个文件，运行时不用光盘，即使没有光驱也可以。qcow2镜像格式是QEMU模拟器支持的一种磁盘镜像，它也是可以用一个文件的形式来表示一块固定大小的块设备磁盘。img格式也是镜像的一种，可以通过制作数据光盘或者使用虚拟光驱安装img数据文件。
### 未完成工作
- 用xshell或者远程桌面连接实例
### 问题与困难
- 尝试用xshell或者远程桌面连接实例都失败了，之后就用ping命令检查网络是否连通，我的网络拓扑图如下：

  ![tuopu](https://github.com/CourseCloudDesktop/cloudDesktop/blob/wcl-develop/task3/screenshot/拓扑.PNG)

  先从虚拟机ping外部网络，是可以ping通的，但是ping路由器的网关时就不行了。在网上查找资料说是需要更改安全组规则，我的实例的安全组设置如下：

  ![secure](https://github.com/CourseCloudDesktop/cloudDesktop/blob/wcl-develop/task3/screenshot/安全组.PNG)

  与查找到的解决方法设置是相同的，但是仍未解决问题，之后还需要找解决方法。


## 下周工作计划
- 解决虚拟机ping不通实例的问题
- 进行下一阶段的学习