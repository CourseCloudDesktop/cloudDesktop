# 选题：nova组件的学习

OpenStack组件总体架构：

<div align=center> <img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task6/image/1.png" width="60%" height="60%" /></div>

理解Nova是理解OpenStack的基础。</br>
我们小组决定着重学习nova，并选择nova-compute来进行深入的介绍：

* nova-compute的结构
* nova-compute的功能
* nova-compute的设计思路
* nova-compute的实现原理

## 1、学习openstack中的nova组件(总体逻辑结构)，选择nova-compute进行深入学习

此部分，我们计划阅读[nova的官方文档](https://docs.openstack.org/nova/pike/index.html)和一些正确性较高的技术博客进行总体梳理。
了解nova的大致轮廓后，我们把重心放在nova最重要的一个服务——[nova-compute](https://docs.openstack.org/nova/pike/cli/nova-compute.html)上，着重研究nova-compute的结构、功能，以及nova-compute和其它组件之间的关系。

### 关于nova-compute的功能
nova-compute 的功能可以分为两类：</br>
* 定时向 OpenStack 报告计算节点的状态；</br>
* 实现 instance 生命周期的管理。

我们分别针对这两部分内容进行来深入地介绍nova-compute组件。

### 关于nova-compute和其它组件之间的关系
了解组件之间、组件内部的通信机制。


## 2、阐述nova-compute的设计思路与实现原理

此部分，我们计划通过阅读[nova-compute相关源码](http://git.openstack.org/cgit)，了解nova-compute的设计思路与实现原理，
并在第1步的基础上加深对消息如何通信、功能如何实现的理解。

此外，在已经用allinone方式部署的机器上，查看以下路径：
```
/etc/nova/nova.conf
/etc/nova/policy.json
/etc/nova/rootwrap.conf
/etc/nova/rootwrap.d/
```
## 3、了解其它nova服务（如果时间充裕）

### driver框架，包含hypervisor种类及其介绍，如何选择，如何与hypervisor交互

nova-compute 为这些 Hypervisor 定义了统一的接口，Hypervisor 只需要实现这些接口，就可以 Driver 的形式即插即用到 OpenStack 系统中。
下面是Nova Driver的架构示意图：

<div align=center> <img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task6/image/3.png" width="60%" height="60%" /></div>

### nova对虚拟机的调度机制

即scheduler调度服务，nova-sheduler如何选取一个最合适的计算节点来运行虚拟机。

通过使用过滤器来选择最优的计算节点：介绍 nova-scheduler 的调度机制和实现方法：即解决如何选择在哪个计算节点上启动 instance 的问题。通过介绍Filter scheduler过滤器，来讲述nova-scheduler。Filter scheduler 是 nova-scheduler 默认的调度器，调度过程分为两步： 通过过滤器（filter）选择满足条件的计算节点（运行 nova-compute）；通过权重计算（weighting）选择在最优（权重值最大）的计算节点上创建 Instance。

    scheduler_driver=nova.scheduler.filter_scheduler.FilterScheduler
    
Nova 允许使用第三方 scheduler，配置 scheduler_driver 即可。 这又一次体现了OpenStack的开放性。 Scheduler 可以使用多个 filter 依次进行过滤，过滤之后的节点再通过计算权重选出最适合的节点。

<div align=center> <img src="https://github.com/CourseCloudDesktop/cloudDesktop/blob/yxf-develop/task6/image/4.png" width="60%" height="60%" /></div>

上图是调度过程的一个示例： 
最开始有 6 个计算节点 Host1-Host6；通过多个 filter 层层过滤，Host2 和 Host4 没有通过，被刷掉了；Host1，Host3，Host5，Host6 计算权重，结果 Host5 得分最高，最终入选。对于上述过程进行详细的份详细来介绍nova-scheduler

## 我们期待的结果

* 1.能够理清OpenStack的总体架构，明白各个模块的基本功能和基本通信方式。
* 2.能够对nova的架构进行比较深入的理解，可以自己画出架构草图来表现各个组件的关系。
* 3.通过动手实践来理解nova-compute 如何实现instance launch（部署）操作
* 4.通过阅读源码，分析nova创建虚机流程，尝试捕获一次完整的创建虚拟机操作的通信过程
* 5.了解其它nova组件（如果时间充裕）


以上是我们考核的选题和学习计划，实际的学习过程会根据实际进度来进行调整。
